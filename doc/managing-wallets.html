<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>managing-wallets - Bitcoin Core Developer Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Bitcoin Core Developer Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="managing-the-wallet"><a class="header" href="#managing-the-wallet">Managing the Wallet</a></h1>
<h2 id="1-backing-up-and-restoring-the-wallet"><a class="header" href="#1-backing-up-and-restoring-the-wallet">1. Backing Up and Restoring The Wallet</a></h2>
<h3 id="11-creating-the-wallet"><a class="header" href="#11-creating-the-wallet">1.1 Creating the Wallet</a></h3>
<p>Since version 0.21, Bitcoin Core no longer has a default wallet.
Wallets can be created with the <code>createwallet</code> RPC or with the <code>Create wallet</code> GUI menu item.</p>
<p>In the GUI, the <code>Create a new wallet</code> button is displayed on the main screen when there is no wallet loaded. Alternatively, there is the option <code>File</code> -&gt;<code>Create wallet</code>.</p>
<p>The following command, for example, creates a descriptor wallet. More information about this command may be found by running <code>bitcoin-cli help createwallet</code>.</p>
<pre><code>$ bitcoin-cli createwallet "wallet-01"
</code></pre>
<p>By default, wallets are created in the <code>wallets</code> folder of the data directory, which varies by operating system, as shown below. The user can change the default by using the <code>-datadir</code> or <code>-walletdir</code> initialization parameters.</p>
<div class="table-wrapper"><table><thead><tr><th>Operating System</th><th style="text-align: left">Default wallet directory</th></tr></thead><tbody>
<tr><td>Linux</td><td style="text-align: left"><code>/home/&lt;user&gt;/.bitcoin/wallets</code></td></tr>
<tr><td>Windows</td><td style="text-align: left"><code>C:\Users\&lt;user&gt;\AppData\Local\Bitcoin\wallets</code></td></tr>
<tr><td>macOS</td><td style="text-align: left"><code>/Users/&lt;user&gt;/Library/Application Support/Bitcoin/wallets</code></td></tr>
</tbody></table>
</div>
<h3 id="12-encrypting-the-wallet"><a class="header" href="#12-encrypting-the-wallet">1.2 Encrypting the Wallet</a></h3>
<p>The <code>wallet.dat</code> file is not encrypted by default and is, therefore, vulnerable if an attacker gains access to the device where the wallet or the backups are stored.</p>
<p>Wallet encryption may prevent unauthorized access. However, this significantly increases the risk of losing coins due to forgotten passphrases. There is no way to recover a passphrase. This tradeoff should be well thought out by the user.</p>
<p>Wallet encryption may also not protect against more sophisticated attacks. An attacker can, for example, obtain the password by installing a keylogger on the user's machine.</p>
<p>After encrypting the wallet or changing the passphrase, a new backup needs to be created immediately. The reason is that the keypool is flushed and a new HD seed is generated after encryption. Any bitcoins received by the new seed cannot be recovered from the previous backups.</p>
<p>The wallet's private key may be encrypted with the following command:</p>
<pre><code>$ bitcoin-cli -rpcwallet="wallet-01" encryptwallet "passphrase"
</code></pre>
<p>Once encrypted, the passphrase can be changed with the <code>walletpassphrasechange</code> command.</p>
<pre><code>$ bitcoin-cli -rpcwallet="wallet-01" walletpassphrasechange "oldpassphrase" "newpassphrase"
</code></pre>
<p>The argument passed to <code>-rpcwallet</code> is the name of the wallet to be encrypted.</p>
<p>Only the wallet's private key is encrypted. All other wallet information, such as transactions, is still visible.</p>
<p>The wallet's private key can also be encrypted in the <code>createwallet</code> command via the <code>passphrase</code> argument:</p>
<pre><code>$ bitcoin-cli -named createwallet wallet_name="wallet-01" passphrase="passphrase"
</code></pre>
<p>Note that if the passphrase is lost, all the coins in the wallet will also be lost forever.</p>
<h3 id="13-unlocking-the-wallet"><a class="header" href="#13-unlocking-the-wallet">1.3 Unlocking the Wallet</a></h3>
<p>If the wallet is encrypted and the user tries any operation related to private keys, such as sending bitcoins, an error message will be displayed.</p>
<pre><code>$ bitcoin-cli -rpcwallet="wallet-01" sendtoaddress "tb1qw508d6qejxtdg4y5r3zarvary0c5xw7kxpjzsx" 0.01
error code: -13
error message:
Error: Please enter the wallet passphrase with walletpassphrase first.
</code></pre>
<p>To unlock the wallet and allow it to run these operations, the <code>walletpassphrase</code> RPC is required.</p>
<p>This command takes the passphrase and an argument called <code>timeout</code>, which specifies the time in seconds that the wallet decryption key is stored in memory. After this period expires, the user needs to execute this RPC again.</p>
<pre><code>$ bitcoin-cli -rpcwallet="wallet-01" walletpassphrase "passphrase" 120
</code></pre>
<p>In the GUI, there is no specific menu item to unlock the wallet. When the user sends bitcoins, the passphrase will be prompted automatically.</p>
<h3 id="14-backing-up-the-wallet"><a class="header" href="#14-backing-up-the-wallet">1.4 Backing Up the Wallet</a></h3>
<p>To backup the wallet, the <code>backupwallet</code> RPC or the <code>Backup Wallet</code> GUI menu item must be used to ensure the file is in a safe state when the copy is made.</p>
<p>In the RPC, the destination parameter must include the name of the file. Otherwise, the command will return an error message like "Error: Wallet backup failed!" for descriptor wallets. If it is a legacy wallet, it will be copied and a file will be created with the default file name <code>wallet.dat</code>.</p>
<pre><code>$ bitcoin-cli -rpcwallet="wallet-01" backupwallet /home/node01/Backups/backup-01.dat
</code></pre>
<p>In the GUI, the wallet is selected in the <code>Wallet</code> drop-down list in the upper right corner. If this list is not present, the wallet can be loaded in <code>File</code> -&gt;<code>Open Wallet</code> if necessary. Then, the backup can be done in <code>File</code> -&gt; <code>Backup Wallet…</code>.</p>
<p>This backup file can be stored on one or multiple offline devices, which must be reliable enough to work in an emergency and be malware free. Backup files can be regularly tested to avoid problems in the future.</p>
<p>If the computer has malware, it can compromise the wallet when recovering the backup file. One way to minimize this is to not connect the backup to an online device.</p>
<p>If both the wallet and all backups are lost for any reason, the bitcoins related to this wallet will become permanently inaccessible.</p>
<h3 id="15-backup-frequency"><a class="header" href="#15-backup-frequency">1.5 Backup Frequency</a></h3>
<p>The original Bitcoin Core wallet was a collection of unrelated private keys. If a non-HD wallet had received funds to an address and then was restored from a backup made before the address was generated, then any funds sent to that address would have been lost because there was no deterministic mechanism to derive the address again.</p>
<p>Bitcoin Core <a href="https://github.com/bitcoin/bitcoin/blob/master/doc/release-notes/release-notes-0.13.0.md">version 0.13</a> introduced HD wallets with deterministic key derivation. With HD wallets, users no longer lose funds when restoring old backups because all addresses are derived from the HD wallet seed.</p>
<p>This means that a single backup is enough to recover the coins at any time. It is still recommended to make regular backups (once a week) or after a significant number of new transactions to maintain the metadata, such as labels. Metadata cannot be retrieved from a blockchain rescan, so if the backup is too old, the metadata will be lost forever.</p>
<p>Wallets created before version 0.13 are not HD and must be backed up every 100 keys used since the previous backup, or even more often to maintain the metadata.</p>
<h3 id="16-restoring-the-wallet-from-a-backup"><a class="header" href="#16-restoring-the-wallet-from-a-backup">1.6 Restoring the Wallet From a Backup</a></h3>
<p>To restore a wallet, the <code>restorewallet</code> RPC or the <code>Restore Wallet</code> GUI menu item (<code>File</code> -&gt; <code>Restore Wallet…</code>) must be used.</p>
<pre><code>$ bitcoin-cli restorewallet "restored-wallet" /home/node01/Backups/backup-01.dat
</code></pre>
<p>After that, <code>getwalletinfo</code> can be used to check if the wallet has been fully restored.</p>
<pre><code>$ bitcoin-cli -rpcwallet="restored-wallet" getwalletinfo
</code></pre>
<p>The restored wallet can also be loaded in the GUI via <code>File</code> -&gt;<code>Open wallet</code>.</p>
<h2 id="wallet-passphrase"><a class="header" href="#wallet-passphrase">Wallet Passphrase</a></h2>
<p>Understanding wallet security is crucial for safely storing your Bitcoin. A key aspect is the wallet passphrase, used for encryption. Let's explore its nuances, role, encryption process, and limitations.</p>
<ul>
<li>
<p><strong>Not the Seed:</strong>
The wallet passphrase and the seed are two separate components in wallet security. The seed, or HD seed, functions as a master key for deriving private and public keys in a hierarchical deterministic (HD) wallet. In contrast, the passphrase serves as an additional layer of security specifically designed to secure the private keys within the wallet. The passphrase serves as a safeguard, demanding an additional layer of authentication to access funds in the wallet.</p>
</li>
<li>
<p><strong>Protection Against Unauthorized Access:</strong>
The passphrase serves as a protective measure, securing your funds in situations where an unauthorized user gains access to your unlocked computer or device while your wallet application is active. Without the passphrase, they would be unable to access your wallet's funds or execute transactions. However, it's essential to be aware that someone with access can potentially compromise the security of your passphrase by installing a keylogger.</p>
</li>
<li>
<p><strong>Doesn't Encrypt Metadata or Public Keys:</strong>
It's important to note that the passphrase primarily secures the private keys and access to funds within the wallet. It does not encrypt metadata associated with transactions or public keys. Information about your transaction history and the public keys involved may still be visible.</p>
</li>
<li>
<p><strong>Risk of Fund Loss if Forgotten or Lost:</strong>
If the wallet passphrase is too complex and is subsequently forgotten or lost, there is a risk of losing access to the funds permanently. A forgotten passphrase will result in the inability to unlock the wallet and access the funds.</p>
</li>
</ul>
<h2 id="migrating-legacy-wallets-to-descriptor-wallets"><a class="header" href="#migrating-legacy-wallets-to-descriptor-wallets">Migrating Legacy Wallets to Descriptor Wallets</a></h2>
<p>Legacy wallets (traditional non-descriptor wallets) can be migrated to become Descriptor wallets
through the use of the <code>migratewallet</code> RPC. Migrated wallets will have all of their addresses and private keys added to
a newly created Descriptor wallet that has the same name as the original wallet. Because Descriptor
wallets do not support having private keys and watch-only scripts, there may be up to two
additional wallets created after migration. In addition to a descriptor wallet of the same name,
there may also be a wallet named <code>&lt;name&gt;_watchonly</code> and <code>&lt;name&gt;_solvables</code>. <code>&lt;name&gt;_watchonly</code>
contains all of the watchonly scripts. <code>&lt;name&gt;_solvables</code> contains any scripts which the wallet
knows but is not watching the corresponding P2(W)SH scripts.</p>
<p>Migrated wallets will also generate new addresses differently. While the same BIP 32 seed will be
used, the BIP 44, 49, 84, and 86 standard derivation paths will be used. After migrating, a new
backup of the wallet(s) will need to be created.</p>
<p>Given that there is an extremely large number of possible configurations for the scripts that
Legacy wallets can know about, be watching for, and be able to sign for, <code>migratewallet</code> only
makes a best effort attempt to capture all of these things into Descriptor wallets. There may be
unforeseen configurations which result in some scripts being excluded. If a migration fails
unexpectedly or otherwise misses any scripts, please create an issue on GitHub. A backup of the
original wallet can be found in the wallet directory with the name <code>&lt;name&gt;-&lt;timestamp&gt;.legacy.bak</code>.</p>
<p>The backup can be restored using the methods discussed in the
<a href="#16-restoring-the-wallet-from-a-backup">Restoring the Wallet From a Backup</a> section.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../doc/init.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../doc/multiprocess.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../doc/init.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../doc/multiprocess.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
